---
// DespedidaBoda.astro
---

<section class="relative w-full py-4 px-6">
    <!-- HOJAS DECORATIVAS - Pegadas a los bordes de la pantalla -->

    <!-- Hoja izquierda - AL BORDE IZQUIERDO -->
    <img
        src="/imagenes/florlateral.png"
        alt="hojas"
        class="absolute left-0 top-20 md:top-24 w-12 h-12 md:w-16 md:h-16 opacity-0 pointer-events-none z-10"
        id="hoja-despedida-left"
    />

    <!-- Hoja derecha - AL BORDE DERECHO (volteada horizontalmente) -->
    <img
        src="/imagenes/florlateral.png"
        alt="hojas"
        class="absolute right-0 top-20 md:top-24 w-12 h-12 md:w-16 md:h-16 opacity-0 pointer-events-none z-10 scale-x-[-1]"
        id="hoja-despedida-right"
    />

    <!-- CONTENEDOR PRINCIPAL -->
    <div class="max-w-md mx-auto" id="wrapper-despedida">
        <!-- DESPEDIDA -->
        <div class="text-center opacity-0" id="despedida-content">
            <!-- TÃ­tulo -->
            <h3
                class="text-[#9C7A2E] tracking-[0.2em] uppercase text-xl md:text-2xl lg:text-2xl xl:text-3xl font-semibold mb-6"
            >
                Querida Familia y Amigos
            </h3>

            <!-- Icono CorazÃ³n -->
            <div class="flex justify-center mb-6">
                <svg
                    class="w-8 h-8 md:w-20 md:h-20 text-[#9C7A2E]"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                    id="icono-corazon"
                >
                    <path
                        d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"
                    ></path>
                </svg>
            </div>

            <!-- Mensaje Principal -->
            <p
                class="font-charm text-[#0F3D2E] text-xl md:text-xl lg:text-2xl xl:text-2xl mb-6 leading-relaxed"
            >
                Nos llena de felicidad poder compartir con ustedes este momento
                tan Ãºnico y especial. Con la esperanza de que hagamos de este
                dÃ­a un recuerdo inolvidable. Los esperamos con los corazones
                llenos de emociÃ³n, listos para celebrar el amor y crear memorias
                que permanezcan siempre en nuestros corazones.
            </p>

            <!-- Texto Confirmar Asistencia -->
            <p
                class="font-charm text-[#9C7A2E] text-xl md:text-2xl lg:text-2xl xl:text-3xl font-bold mb-4"
            >
                Esperamos contar con tu presencia
            </p>

            <p
                class="text-[#0F3D2E]/70 text-lg md:text-lg lg:text-xl xl:text-2xl mb-6"
            >
                Por favor, confirma tu asistencia haciendo clic en el botÃ³n
            </p>
            <!-- BotÃ³n Confirmar con MANO -->
            <div class="flex items-center justify-center">
                <div class="relative">
                    <a
                        href="https://wa.me/59112345678?text=Hola,%20confirmo%20mi%20asistencia%20a%20la%20boda"
                        target="_blank"
                        id="btn-abrir-modal-despedida"
                        class="bg-[#4E5F49] hover:bg-[#3d4a39] text-white px-8 py-3
                    rounded text-base md:text-lg lg:text-xl xl:text-2xl
                    font-semibold transition-all duration-300 shadow-md
                    hover:shadow-lg inline-block text-center"
                    >
                        Confirmar Asistencia
                    </a>

                    <!-- MANO apuntando al botÃ³n -->
                    <img
                        src="/imagenes/mano.png"
                        alt="Presionar aquÃ­"
                        class="absolute -bottom-4 -right-4 w-8 h-8 object-contain opacity-0 pointer-events-none z-20"
                        id="mano-pointer-despedida"
                    />
                </div>
            </div>
        </div>
    </div>

    <!-- ðŸŽ¯ MODAL DE CONFIRMACIÃ“N -->
    <div
        id="modal-confirmacion-despedida"
        class="hidden fixed inset-0 z-50 flex items-center justify-center p-4"
    >
        <!-- Overlay con blur -->
        <div
            class="absolute inset-0 bg-black/60 backdrop-blur-sm"
            id="modal-overlay-despedida"
        >
        </div>

        <!-- Modal Card -->
        <div
            class="relative bg-gradient-to-br from-white via-[#faf8f5] to-[#f5f1eb] rounded-3xl border-2 border-[#C9A961]/30 shadow-2xl max-w-md w-full p-8 md:p-10"
            id="modal-card-despedida"
        >
            <!-- BotÃ³n cerrar -->
            <button
                id="btn-cerrar-modal-despedida"
                class="absolute top-4 right-4 text-[#8b7355] hover:text-[#C9A961] transition-colors"
            >
                <svg
                    class="w-6 h-6"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>

            <!-- Icono decorativo -->
            <div class="flex justify-center mb-6">
                <div class="bg-[#C9A961]/10 p-4 rounded-full">
                    <svg
                        class="w-12 h-12 text-[#C9A961]"
                        viewBox="0 0 24 24"
                        fill="currentColor"
                    >
                        <path
                            d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"
                        ></path>
                    </svg>
                </div>
            </div>

            <!-- TÃ­tulo -->
            <h3
                class="font-charm text-3xl text-[#C9A961] font-bold text-center mb-2"
            >
                Confirma tu Asistencia
            </h3>
            <p class="font-charm text-lg text-[#8b7355] text-center mb-8">
                Nos encantarÃ­a contar contigo
            </p>

            <!-- Formulario -->
            <div id="formulario-confirmacion-despedida" class="space-y-6">
                <!-- Campo Nombre -->
                <div>
                    <label class="block font-charm text-lg text-[#8b7355] mb-2"
                        >Tu nombre completo</label
                    >
                    <input
                        type="text"
                        id="input-nombre-despedida"
                        placeholder="Escribe tu nombre"
                        class="w-full px-4 py-3 rounded-xl border-2 border-[#C9A961]/30 bg-white/80 font-charm text-lg text-[#8b7355] focus:outline-none focus:border-[#C9A961] focus:ring-2 focus:ring-[#C9A961]/20 transition-all"
                        required
                    />
                </div>

                <!-- Pregunta Asistencia -->
                <div>
                    <label
                        class="block font-charm text-lg text-[#8b7355] mb-3 text-center"
                        >Â¿Confirmas tu asistencia?</label
                    >
                    <div class="flex gap-4">
                        <button
                            type="button"
                            class="btn-asistencia-despedida flex-1 py-4 rounded-xl border-2 border-gray-300 bg-white text-gray-600 font-charm text-xl transition-all duration-300"
                            data-value="si"
                        >
                            âœ“ SÃ­ asistirÃ©
                        </button>
                        <button
                            type="button"
                            class="btn-asistencia-despedida flex-1 py-4 rounded-xl border-2 border-gray-300 bg-white text-gray-600 font-charm text-xl transition-all duration-300"
                            data-value="no"
                        >
                            âœ— No podrÃ©
                        </button>
                    </div>
                </div>

                <!-- Mensaje de error -->
                <div
                    id="mensaje-error-despedida"
                    class="hidden text-center text-red-500 font-charm text-sm"
                >
                </div>

                <!-- BotÃ³n Enviar -->
                <button
                    type="button"
                    id="btn-enviar-despedida"
                    class="w-full py-4 bg-gradient-to-r from-[#C9A961] to-[#d4b16e] text-white font-charm text-2xl font-bold rounded-xl shadow-lg hover:shadow-xl hover:scale-105 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
                >
                    Enviar ConfirmaciÃ³n
                </button>
            </div>

            <!-- Mensaje de Ã©xito -->
            <div id="mensaje-exito-despedida" class="hidden text-center">
                <div class="mb-4">
                    <svg
                        class="w-16 h-16 text-green-500 mx-auto"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                        ></path>
                    </svg>
                </div>
                <h4 class="font-charm text-2xl text-[#C9A961] font-bold mb-2">
                    Â¡ConfirmaciÃ³n Enviada!
                </h4>
                <p class="font-charm text-lg text-[#8b7355] mb-6">
                    Gracias por confirmar tu asistencia
                </p>
                <button
                    id="btn-cerrar-exito-despedida"
                    class="px-8 py-3 bg-[#C9A961] text-white font-charm text-lg rounded-xl hover:bg-[#d4b16e] transition-all"
                >
                    Cerrar
                </button>
            </div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- ðŸŽ¬ ANIMACIONES CON GSAP                                     -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <script>
        import { gsap } from "gsap";
        import { ScrollTrigger } from "gsap/ScrollTrigger";

        gsap.registerPlugin(ScrollTrigger);

        const initDespedidaBoda = () => {
            console.log("ðŸ’‘ Iniciando componente Despedida de Boda...");

            // â•â•â• ESTADO INICIAL â•â•â•
            gsap.set("#despedida-content", {
                opacity: 0,
                y: 30,
            });
            gsap.set("#hoja-despedida-left", {
                opacity: 0,
                x: -20,
            });
            gsap.set("#hoja-despedida-right", {
                opacity: 0,
                x: 20,
            });
            gsap.set("#mano-pointer-despedida", {
                opacity: 0,
                scale: 0.8,
            });

            // â•â•â• ANIMACIÃ“N AL ENTRAR â•â•â•
            ScrollTrigger.create({
                trigger: "#wrapper-despedida",
                start: "top 80%",
                end: "top 20%",

                onEnter: () => {
                    const tl = gsap.timeline();

                    // 1ï¸âƒ£ TODO EL CONTENIDO (texto + botones) AL MISMO TIEMPO
                    tl.to(
                        "#despedida-content",
                        {
                            opacity: 1,
                            y: 0,
                            duration: 1.2,
                            ease: "power3.out",
                        },
                        0,
                    )

                        // 2ï¸âƒ£ MEDIO SEGUNDO DESPUÃ‰S: FLORES LATERALES
                        .to(
                            "#hoja-despedida-left",
                            {
                                opacity: 0.8,
                                x: 0,
                                duration: 1,
                                ease: "power2.out",
                            },
                            0.5,
                        )

                        .to(
                            "#hoja-despedida-right",
                            {
                                opacity: 0.8,
                                x: 0,
                                duration: 1,
                                ease: "power2.out",
                            },
                            0.5,
                        )

                        // 3ï¸âƒ£ MANO despuÃ©s de todo
                        .to(
                            "#mano-pointer-despedida",
                            {
                                opacity: 1,
                                scale: 1,
                                duration: 0.5,
                                ease: "back.out(2)",
                            },
                            1.5,
                        );

                    // â•â•â• ANIMACIÃ“N DE PRESIONAR BOTÃ“N (loop infinito) â•â•â•
                    gsap.to("#mano-pointer-despedida", {
                        scale: 0.9,
                        duration: 0.6,
                        ease: "power1.inOut",
                        repeat: -1,
                        yoyo: true,
                        delay: 2,
                    });
                },

                onLeaveBack: () => {
                    const tl = gsap.timeline();

                    // Detener la animaciÃ³n de la mano
                    gsap.killTweensOf("#mano-pointer-despedida");

                    tl.to(
                        "#despedida-content, #hoja-despedida-left, #hoja-despedida-right, #mano-pointer-despedida",
                        {
                            opacity: 0,
                            duration: 0.5,
                            ease: "power2.in",
                        },
                    )
                        .to(
                            "#despedida-content",
                            {
                                y: 30,
                                duration: 0.5,
                                ease: "power2.in",
                            },
                            "<",
                        )
                        .to(
                            "#hoja-despedida-left",
                            {
                                x: -20,
                                duration: 0.5,
                                ease: "power2.in",
                            },
                            "<",
                        )
                        .to(
                            "#hoja-despedida-right",
                            {
                                x: 20,
                                duration: 0.5,
                                ease: "power2.in",
                            },
                            "<",
                        )
                        .to(
                            "#mano-pointer-despedida",
                            {
                                scale: 0.8,
                                duration: 0.5,
                                ease: "power2.in",
                            },
                            "<",
                        );
                },
            });

            // â•â•â• LÃ“GICA DEL MODAL â•â•â•
            const modal = document.getElementById(
                "modal-confirmacion-despedida",
            );
            const modalCard = document.getElementById("modal-card-despedida");
            const btnAbrirModal = document.getElementById(
                "btn-abrir-modal-despedida",
            );
            const btnCerrarModal = document.getElementById(
                "btn-cerrar-modal-despedida",
            );
            const modalOverlay = document.getElementById(
                "modal-overlay-despedida",
            );
            const inputNombre = document.getElementById(
                "input-nombre-despedida",
            );
            const botonesAsistencia = document.querySelectorAll(
                ".btn-asistencia-despedida",
            );
            const btnEnviar = document.getElementById("btn-enviar-despedida");
            const formulario = document.getElementById(
                "formulario-confirmacion-despedida",
            );
            const mensajeExito = document.getElementById(
                "mensaje-exito-despedida",
            );
            const mensajeError = document.getElementById(
                "mensaje-error-despedida",
            );
            const btnCerrarExito = document.getElementById(
                "btn-cerrar-exito-despedida",
            );

            let asistenciaSeleccionada = null;

            // Abrir modal
            btnAbrirModal?.addEventListener("click", () => {
                modal?.classList.remove("hidden");
                gsap.fromTo(
                    modalCard,
                    { scale: 0.8, opacity: 0 },
                    {
                        scale: 1,
                        opacity: 1,
                        duration: 0.4,
                        ease: "back.out(1.5)",
                    },
                );
            });

            // Cerrar modal
            const cerrarModal = () => {
                gsap.to(modalCard, {
                    scale: 0.8,
                    opacity: 0,
                    duration: 0.3,
                    ease: "power2.in",
                    onComplete: () => {
                        modal?.classList.add("hidden");
                        resetearFormulario();
                    },
                });
            };

            btnCerrarModal?.addEventListener("click", cerrarModal);
            modalOverlay?.addEventListener("click", cerrarModal);
            btnCerrarExito?.addEventListener("click", cerrarModal);

            // SelecciÃ³n de asistencia
            botonesAsistencia.forEach((btn) => {
                btn.addEventListener("click", () => {
                    const valor = btn.dataset.value;

                    // Resetear todos los botones
                    botonesAsistencia.forEach((b) => {
                        b.classList.remove(
                            "bg-green-600",
                            "border-green-600",
                            "bg-red-600",
                            "border-red-600",
                            "text-white",
                            "shadow-xl",
                            "font-bold",
                        );
                        b.classList.add(
                            "border-gray-300",
                            "bg-white",
                            "text-gray-600",
                            "font-normal",
                        );
                        b.style.transform = "scale(1)";
                        b.style.backgroundColor = "#ffffff";
                        b.style.borderColor = "#d1d5db";
                        b.style.color = "#6b7280";
                    });

                    // Aplicar estilo al botÃ³n seleccionado
                    btn.classList.remove(
                        "border-gray-300",
                        "bg-white",
                        "text-gray-600",
                        "font-normal",
                    );

                    if (valor === "si") {
                        btn.classList.add(
                            "bg-green-600",
                            "border-green-600",
                            "text-white",
                            "shadow-xl",
                            "font-bold",
                        );
                        btn.style.backgroundColor = "#16a34a";
                        btn.style.borderColor = "#16a34a";
                        btn.style.color = "#ffffff";
                    } else {
                        btn.classList.add(
                            "bg-red-600",
                            "border-red-600",
                            "text-white",
                            "shadow-xl",
                            "font-bold",
                        );
                        btn.style.backgroundColor = "#dc2626";
                        btn.style.borderColor = "#dc2626";
                        btn.style.color = "#ffffff";
                    }

                    btn.style.transform = "scale(1.08)";
                    asistenciaSeleccionada = valor;
                    mensajeError?.classList.add("hidden");

                    gsap.fromTo(
                        btn,
                        { scale: 1.08 },
                        {
                            scale: 1.15,
                            duration: 0.15,
                            yoyo: true,
                            repeat: 1,
                            ease: "power2.inOut",
                        },
                    );
                });
            });

            // Enviar confirmaciÃ³n
            btnEnviar?.addEventListener("click", async () => {
                const nombre = inputNombre?.value.trim();

                if (!nombre) {
                    mensajeError.textContent = "Por favor ingresa tu nombre";
                    mensajeError?.classList.remove("hidden");
                    return;
                }

                if (!asistenciaSeleccionada) {
                    mensajeError.textContent =
                        "Por favor selecciona si asistirÃ¡s o no";
                    mensajeError?.classList.remove("hidden");
                    return;
                }

                btnEnviar.disabled = true;
                btnEnviar.textContent = "Enviando...";

                try {
                    const SCRIPT_URL =
                        "https://script.google.com/macros/s/AKfycbydSOEp9OVQbsk-nsDosm-ZlFF7pi-2tzUow6-tl9bOEpMSSsYd-H_gO33Lgn8fdgg2eA/exec";

                    await fetch(SCRIPT_URL, {
                        method: "POST",
                        mode: "no-cors",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            nombre: nombre,
                            asistencia:
                                asistenciaSeleccionada === "si" ? "SÃ­" : "No",
                            fecha: new Date().toLocaleString("es-ES", {
                                timeZone: "America/La_Paz",
                            }),
                        }),
                    });

                    formulario?.classList.add("hidden");
                    mensajeExito?.classList.remove("hidden");
                } catch (error) {
                    console.error("Error:", error);
                    mensajeError.textContent =
                        "Hubo un error. Por favor intenta de nuevo.";
                    mensajeError?.classList.remove("hidden");
                    btnEnviar.disabled = false;
                    btnEnviar.textContent = "Enviar ConfirmaciÃ³n";
                }
            });

            // Resetear formulario
            const resetearFormulario = () => {
                if (inputNombre) inputNombre.value = "";
                asistenciaSeleccionada = null;
                botonesAsistencia.forEach((b) => {
                    b.classList.remove(
                        "bg-green-600",
                        "border-green-600",
                        "bg-red-600",
                        "border-red-600",
                        "text-white",
                        "shadow-xl",
                        "font-bold",
                    );
                    b.classList.add(
                        "border-gray-300",
                        "bg-white",
                        "text-gray-600",
                        "font-normal",
                    );
                    b.style.transform = "scale(1)";
                    b.style.backgroundColor = "";
                    b.style.borderColor = "";
                    b.style.color = "";
                });
                mensajeError?.classList.add("hidden");
                formulario?.classList.remove("hidden");
                mensajeExito?.classList.add("hidden");
                if (btnEnviar) {
                    btnEnviar.disabled = false;
                    btnEnviar.textContent = "Enviar ConfirmaciÃ³n";
                }
            };

            console.log("ðŸ’‘âœ¨ Despedida de Boda activada!");
        };

        document.addEventListener("DOMContentLoaded", initDespedidaBoda);
        document.addEventListener("astro:page-load", initDespedidaBoda);
    </script>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- ðŸŽ¨ ESTILOS                                                   -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <style>
        .btn-asistencia-despedida:hover {
            transform: translateY(-3px) !important;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            border-color: #c9a961;
        }

        .btn-asistencia-despedida.bg-green-600 {
            background-color: #16a34a !important;
            border-color: #16a34a !important;
        }

        .btn-asistencia-despedida.bg-red-600 {
            background-color: #dc2626 !important;
            border-color: #dc2626 !important;
        }
    </style>
</section>
